name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Setup vcpkg
      uses: lukka/run-vcpkg@v11
      with:
        vcpkgGitCommitId: 'e3ed41868d5034bc608eaaa58383cd6ecdbb5ffb'

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: Configure CMake (Skyrim)
      run: cmake --preset skyrim

    - name: Build (Skyrim)
      run: cmake --build build/skyrim --config Release

    - name: Configure CMake (Skyrim VR)
      run: cmake --preset vr

    - name: Build (Skyrim VR)
      run: cmake --build build/vr --config Release

    - name: Upload Skyrim artifacts
      uses: actions/upload-artifact@v4
      with:
        name: skyrim-dualsense-se
        path: build/skyrim/Release/*.dll

    - name: Upload Skyrim VR artifacts
      uses: actions/upload-artifact@v4
      with:
        name: skyrim-dualsense-vr
        path: build/vr/Release/*.dll